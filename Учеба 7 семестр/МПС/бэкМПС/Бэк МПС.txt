/*
 * MPS_2_Ex.cpp
 *
 * Created: 16.10.2017 16:36:22
 * Author : NikitaPC
 */ 

#define F_CPU 8000000


#include <avr/io.h>
#include <util/delay.h>
#include <stdlib.h>
#include <stdio.h>
#include <stdbool.h>
#include <time.h>
#include <avr/interrupt.h>

int i;
// Создаем I, заданные по варианту
int i1 = 0, i2 = 0, i3 = 0, i4 = 0;
// создаем таймеры, заданные по вараинту
int t1 = 0, t2 = 0, t3 = 0;
// значения функций, создание лампочек
int o1 = 0, o2 = 0, o3 = 0, o4 = 0;

void initTimer() {

	 MCUCR |= (1 << ISC00);    // set INT0 to trigger on ANY logic change
	 GICR |= (1 << INT0);      // Turns on INT0

	TCCR1B |= (1<<WGM12);
	TIMSK |= (1<<OCIE1A);
	OCR1AH = 0b01111010;
	OCR1AL = 0b00010010;
	TCCR1B |= (1<<CS12);

}
void setLeds(void) {
	o1 = (!o2 && !o3 && !o4) && t3;
	o2 = (i4 || o4 || i3) && t1;
	o3 = (i1 && i2) && t2;
	o4 = o3 && i3;
	PORTC = o1 ? PORTC | (1<<PORTC0) : PORTC & ~(1<<PORTC0);
	PORTC = o2 ? PORTC | (1<<PORTC1) : PORTC & ~(1<<PORTC1);
	PORTC = o3 ? PORTC | (1<<PORTC2) : PORTC & ~(1<<PORTC2);
	PORTC = o4 ? PORTC | (1<<PORTC3) : PORTC & ~(1<<PORTC3);

}

ISR (TIMER1_COMPA_vect)
{
	i++;
	if (i % 5 == 0) t1 = !t1;
	if (i % 7 == 0) t2 = !t2;
	if (i % 9 == 0) t3 = !t3;
	setLeds();
}

ISR(INT0_vect)
{
	i = 0;
	PORTC &= ~(1<<PORTC5);
	PORTC ^= (1<<PORTC5);
}


int main (void)
{
	initTimer();
	// Устаналиваем PORTB на режим чтения
	DDRB = 0x00;
	PORTB = 0x00;
	// Устаналиваем PORTС на режим записи
	DDRC = 0xFF;
	PORTC = 0x00;

	i = 0;
	sei();
	i1 = PINB&(1<<0);
	i2 = PINB&(1<<1);
	i3 = PINB&(1<<2);
	i4 = PINB&(1<<3);
	setLeds();


	while(1) {
		int inp = PINB;
		i1 = inp & (1<<PB0);
		i2 = inp & (1<<PB1);
		i3 = inp & (1<<PB2);
		i4 = inp & (1<<PB3);

	}

}